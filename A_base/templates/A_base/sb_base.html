{% extends 'A_base/base.html' %}

{% block content %}
<article class="spellbook-content sb-prose sb-max-w-none" style="font-family: 'Inter', system-ui, -apple-system, sans-serif;">
  <div class="sb-p-2 sb-md:p-3 sb-lg:p-4" style="background-color: rgba(0, 0, 0, 0.25);">
    {% block spellbook_md %}
    {% endblock %}
  </div>
</article>

<style>
  /* Professional typography for Spellbook content */
  .spellbook-content h1 {
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-top: 2rem;
    margin-bottom: 1.5rem;
  }
  
  .spellbook-content h2 {
    font-weight: 700;
    letter-spacing: -0.01em;
    margin-top: 1.75rem;
    margin-bottom: 1.25rem;
  }
  
  .spellbook-content h3 {
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
  }
  
  .spellbook-content p {
    line-height: 1.7;
    margin-bottom: 1.25rem;
  }
  
  .spellbook-content code {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-weight: 500;
  }
  
  .spellbook-content pre {
    border-radius: 0.75rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .spellbook-content blockquote {
    border-left-width: 4px;
    font-style: italic;
    margin: 1.5rem 0;
    padding-left: 1.5rem;
  }
  
  .spellbook-content a {
    font-weight: 500;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: all 0.2s;
  }
  
  .spellbook-content a:hover {
    text-decoration-thickness: 2px;
  }
  
  .spellbook-content ul, .spellbook-content ol {
    margin-bottom: 1.25rem;
  }
  
  .spellbook-content li {
    margin-bottom: 0.5rem;
  }
  
  /* Clickable header styles */
  .spellbook-content h2[id],
  .spellbook-content h3[id],
  .spellbook-content h4[id] {
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
  }
  
  .spellbook-content h2[id]:hover,
  .spellbook-content h3[id]:hover,
  .spellbook-content h4[id]:hover {
    padding-left: 0.5rem;
  }
  
  /* Add link icon on hover */
  .spellbook-content h2[id]:hover::before,
  .spellbook-content h3[id]:hover::before,
  .spellbook-content h4[id]:hover::before {
    content: '#';
    position: absolute;
    left: -1.25rem;
    color: var(--accent-color);
    opacity: 0.6;
    font-weight: normal;
  }
  
  /* Highlight target header */
  .spellbook-content :target {
    animation: highlight 2s ease;
  }
  
  @keyframes highlight {
    0% { background-color: rgba(var(--accent-color-rgb, 255, 193, 7), 0.3); }
    100% { background-color: transparent; }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get all headers with IDs
  const headers = document.querySelectorAll('.spellbook-content h2[id], .spellbook-content h3[id], .spellbook-content h4[id]');
  
  // Calculate navbar height (including any fixed elements)
  function getNavbarHeight() {
    const navbar = document.querySelector('nav');
    const mastodonBanner = document.querySelector('.mastodon-banner');
    let totalHeight = 0;
    
    if (navbar) {
      totalHeight += navbar.offsetHeight;
    }
    if (mastodonBanner) {
      totalHeight += mastodonBanner.offsetHeight;
    }
    
    // Add a little extra padding
    return totalHeight + 20;
  }
  
  // Smooth scroll to element with offset
  function scrollToElement(element) {
    const offset = getNavbarHeight();
    const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
    const offsetPosition = elementPosition - offset;
    
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
  
  // Add click handlers to headers
  headers.forEach(header => {
    header.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Update URL with the header ID
      const id = this.id;
      if (id) {
        // Update URL without triggering scroll
        history.pushState(null, null, '#' + id);
        
        // Smooth scroll to the header
        scrollToElement(this);
      }
    });
    
    // Add title attribute for better UX
    header.title = 'Click to link to this section';
  });
  
  // Handle initial page load with hash
  if (window.location.hash) {
    // Wait for page to fully load
    setTimeout(() => {
      const targetId = window.location.hash.substring(1);
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        scrollToElement(targetElement);
      }
    }, 100);
  }
  
  // Handle browser back/forward with hash changes
  window.addEventListener('hashchange', function() {
    if (window.location.hash) {
      const targetId = window.location.hash.substring(1);
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        scrollToElement(targetElement);
      }
    }
  });
});
</script>
{% endblock %}