{% extends "A_base/sb_base.html" %}
{% load spellbook_tags %}
{% block page_title %}Interactive Quiz{% endblock page_title %}
{% block content %}
{% load static %}

<div class="quiz-header sb-mt-2 sb-mb-6 sb-p-4 sb-border sb-rounded-md sb-bg-success-25">
    <div class="sb-flex sb-justify-between sb-items-center sb-mb-4">
        <h1 class="sb-text-2xl sb-font-bold">üéØ Interactive Quiz</h1>
        <a href="{% url 'questions:questions_page' %}" class="sb-btn sb-btn-secondary">
            ‚Üê Back to Questions
        </a>
    </div>

    <div class="quiz-info sb-grid sb-grid-cols-1 md:sb-grid-cols-3 sb-gap-4 sb-mb-4">
        <div class="quiz-stat sb-text-center sb-p-3 sb-bg-white sb-rounded-md sb-border">
            <div class="sb-text-2xl sb-font-bold sb-text-primary">{{ quiz_question_count }}</div>
            <div class="sb-text-sm sb-text-gray-600">Questions</div>
        </div>

        <div class="quiz-stat sb-text-center sb-p-3 sb-bg-white sb-rounded-md sb-border">
            <div class="sb-text-2xl sb-font-bold sb-text-info" id="current-question-num">1</div>
            <div class="sb-text-sm sb-text-gray-600">Current</div>
        </div>

        <div class="quiz-stat sb-text-center sb-p-3 sb-bg-white sb-rounded-md sb-border">
            <div class="sb-text-2xl sb-font-bold sb-text-accent" id="score-display">0</div>
            <div class="sb-text-sm sb-text-gray-600">Score</div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container sb-mb-4">
        <div class="sb-text-sm sb-mb-2 sb-text-gray-600">Progress</div>
        <div class="sb-w-full sb-bg-gray-200 sb-rounded-full sb-h-2">
            <div id="progress-bar" class="sb-bg-accent sb-h-2 sb-rounded-full sb-transition-all sb-duration-300" style="width: 0%"></div>
        </div>
    </div>

    {% if selected_tags or selected_titles or selected_difficulty %}
    <div class="quiz-filters sb-text-sm sb-text-gray-600">
        <strong>Quiz Parameters:</strong>
        {% if selected_tags %}
            Tags: {{ selected_tags|join:", " }}
        {% endif %}
        {% if selected_titles %}
            Titles: {{ selected_titles|join:", " }}
        {% endif %}
        {% if selected_difficulty %}
            Difficulty: {{ selected_difficulty|join:", " }}
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- Quiz Controls -->
<div class="quiz-controls sb-mb-6 sb-flex sb-justify-between sb-items-center">
    <button id="prev-question-btn" class="sb-btn sb-btn-secondary" disabled>
        ‚Üê Previous
    </button>

    <div class="quiz-control-center sb-flex sb-gap-3">
        <button id="restart-quiz-btn" class="sb-btn sb-btn-warning">
            üîÑ Restart Quiz
        </button>
        <button id="finish-quiz-btn" class="sb-btn sb-btn-success" style="display: none;">
            ‚úÖ Finish Quiz
        </button>
    </div>

    <button id="next-question-btn" class="sb-btn sb-btn-primary">
        Next ‚Üí
    </button>
</div>

<!-- Quiz Questions Container -->
<div id="quiz-container" class="quiz-questions-container">
    {% if quiz_questions %}
        {% for question in quiz_questions %}
            {% include "questions/partials/question_block/_question_block_quiz.html" %}
        {% endfor %}
    {% else %}
        <div class="no-questions sb-text-center sb-p-8 sb-border sb-rounded-md sb-bg-warning-25">
            <h3 class="sb-text-xl sb-font-semibold sb-mb-2">No Questions Found</h3>
            <p class="sb-text-gray-600 sb-mb-4">
                No questions match your current filter criteria.
                Try adjusting your parameters or
                <a href="{% url 'questions:questions_page' %}" class="sb-text-primary sb-underline">browse all questions</a>.
            </p>
        </div>
    {% endif %}
</div>


<!-- Quiz Completion Modal (hidden by default) -->
<div id="quiz-completion-modal" class="quiz-modal" style="display: none;">
    <div class="modal-content sb-max-w-md sb-mx-auto sb-mt-20 sb-p-6 sb-bg-white sb-border sb-rounded-lg sb-shadow-lg">
        <h2 class="sb-text-2xl sb-font-bold sb-mb-4 sb-text-center">üéâ Quiz Complete!</h2>
        <div class="quiz-results sb-text-center sb-mb-6">
            <div class="sb-text-4xl sb-font-bold sb-text-success mb-2" id="final-score">0/0</div>
            <div class="sb-text-lg sb-text-gray-600" id="score-percentage">0%</div>
        </div>
        <div class="modal-actions sb-flex sb-gap-3 sb-justify-center">
            <button id="restart-quiz-modal-btn" class="sb-btn sb-btn-primary">
                üîÑ Restart Quiz
            </button>
            <a href="{% url 'questions:questions_page' %}" class="sb-btn sb-btn-secondary">
                ‚Üê Back to Questions
            </a>
        </div>
    </div>
</div>
<style>
    /* Base sb-btn styles - Using your CSS variables where applicable */
    .sb-btn {
        display: inline-block;
        font-weight: 600;
        line-height: 1.5;
        text-align: center;
        text-decoration: none;
        vertical-align: middle;
        cursor: pointer;
        user-select: none;
        background-color: transparent;
        border: 1px solid transparent; /* Base border, color variants will override color */
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: var(--sb-border-radius-md, 0.375rem);
        transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, transform 0.15s ease-in-out;
    }
    /* Hover and Focus-Visible for scaling effect */
    .sb-btn:hover,
    .sb-btn:focus-visible {
        /* Combined for consistent visual feedback */
        transform: scale(1.05); /* Scale effect on hover/focus */
    }
    /* Specific focus-visible style for outline/box-shadow if needed beyond hover */
    .sb-btn:focus-visible {
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.4); /* Example focus ring */
    }
    /* If hover also changes other properties like background, ensure they are defined in variant :hover states below */
    /* Disabled state */
    .sb-btn:disabled,
    .sb-btn.sb-disabled {
        pointer-events: none;
        opacity: 0.65;
        transform: none; /* Ensure disabled buttons don't scale */
    }
    /* --- Click Animation (from your old code) --- */
    @keyframes click-animation {
        0% {
            /* Start with a more prominent border using accent color */
            box-shadow: 0 0 0 3px var(--accent-color, #f59e0b), inset 0 0 0 1px var(--accent-color, #f59e0b);
            transform: scale(1.03); /* Slight initial pop for the animation */
        }
        50% {
            /* Briefly 'press in' - could reduce scale or change shadow */
            box-shadow: 0 0 0 1px var(--accent-color, #f59e0b), inset 0 1px 2px rgba(0, 0, 0, 0.2);
            transform: scale(0.98);
        }
        100% {
            /* Return to a slightly popped state before settling */
            box-shadow: 0 0 0 3px var(--accent-color, #f59e0b), inset 0 0 0 1px var(--accent-color, #f59e0b);
            transform: scale(1.03);
        }
    }
    .sb-btn.click-animation {
        /* Apply the animation when this class is added */
        animation: click-animation 0.4s ease-in-out;
    }
    /* --- Color Variants (ensure hover styles here also work with the scale transform) --- */
    /* Primary Button */
    .sb-btn-primary {
        color: #fff;
        background-color: var(--primary-color, #3b82f6);
        border-color: var(--primary-color, #3b82f6);
    }
    .sb-btn-primary:hover {
        color: #fff;
        background-color: #2573df; /* Darker shade */
        border-color: #1c6cd9;
        transform: scale(1.05); /* Explicitly keep or enhance hover transform if needed */
    }
    .sb-btn-primary:focus-visible {
        /* transform: scale(1.05); Combined above */
        box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.5);
    }
    /* Add :active state for immediate feedback on click, separate from keyframe animation */
    .sb-btn-primary:active {
        background-color: #1c6cd9; /* Even darker or same as hover */
        transform: scale(0.98); /* "Pressed" effect */
    }
    /* Secondary Button */
    .sb-btn-secondary {
        color: #fff;
        background-color: var(--secondary-color, #6b7280);
        border-color: var(--secondary-color, #6b7280);
    }
    .sb-btn-secondary:hover {
        color: #fff;
        background-color: #5a6268;
        border-color: #545b62;
        transform: scale(1.05);
    }
    .sb-btn-secondary:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(107, 114, 128, 0.5);
    }
    .sb-btn-secondary:active {
        background-color: #545b62;
        transform: scale(0.98);
    }
    /* Accent Button */
    .sb-btn-accent {
        color: #000;
        background-color: var(--accent-color, #f59e0b);
        border-color: var(--accent-color, #f59e0b);
    }
    .sb-btn-accent:hover {
        color: #000;
        background-color: #e08e0a;
        border-color: #d48609;
        transform: scale(1.05);
    }
    .sb-btn-accent:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(245, 158, 11, 0.5);
    }
    .sb-btn-accent:active {
        background-color: #d48609;
        transform: scale(0.98);
    }
    /* Error Button */
    .sb-btn-error {
        color: #fff;
        background-color: var(--error-color, #dc2626);
        border-color: var(--error-color, #dc2626);
    }
    .sb-btn-error:hover {
        color: #fff;
        background-color: #c02222;
        border-color: #b62020;
        transform: scale(1.05);
    }
    .sb-btn-error:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(220, 38, 38, 0.5);
    }
    .sb-btn-error:active {
        background-color: #b62020;
        transform: scale(0.98);
    }
    /* Warning Button */
    .sb-btn-warning {
        color: #000;
        background-color: var(--warning-color, #f59e0b);
        border-color: var(--warning-color, #f59e0b);
    }
    .sb-btn-warning:hover {
        color: #000;
        background-color: #e08e0a;
        border-color: #d48609;
        transform: scale(1.05);
    }
    .sb-btn-warning:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(245, 158, 11, 0.5);
    }
    .sb-btn-warning:active {
        background-color: #d48609;
        transform: scale(0.98);
    }
    /* Success Button */
    .sb-btn-success {
        color: #fff;
        background-color: var(--success-color, #16a34a);
        border-color: var(--success-color, #16a34a);
    }
    .sb-btn-success:hover {
        color: #fff;
        background-color: #138d40;
        border-color: #11803b;
        transform: scale(1.05);
    }
    .sb-btn-success:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(22, 163, 74, 0.5);
    }
    .sb-btn-success:active {
        background-color: #11803b;
        transform: scale(0.98);
    }
    /* Info Button */
    .sb-btn-info {
        color: #fff;
        background-color: var(--info-color, #2563eb);
        border-color: var(--info-color, #2563eb);
    }
    .sb-btn-info:hover {
        color: #fff;
        background-color: #1e54d3;
        border-color: #1c4fc3;
        transform: scale(1.05);
    }
    .sb-btn-info:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(37, 99, 235, 0.5);
    }
    .sb-btn-info:active {
        background-color: #1c4fc3;
        transform: scale(0.98);
    }
    /* Black Button */
    .sb-btn-black {
        color: #fff;
        background-color: #1f2937;
        border-color: #1f2937;
    }
    .sb-btn-black:hover {
        color: #fff;
        background-color: #111827;
        border-color: #0d1117;
        transform: scale(1.05);
    }
    .sb-btn-black:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(31, 41, 55, 0.5);
    }
    .sb-btn-black:active {
        background-color: #0d1117;
        transform: scale(0.98);
    }
    /* White Button */
    .sb-btn-white {
        color: #1f2937;
        background-color: #ffffff;
        border-color: #d1d5db;
    }
    .sb-btn-white:hover {
        color: #111827;
        background-color: #f9fafb;
        border-color: #adb5bd;
        transform: scale(1.05);
    }
    .sb-btn-white:focus-visible {
        /* transform: scale(1.05); */
        box-shadow: 0 0 0 0.25rem rgba(209, 213, 219, 0.5);
    }
    .sb-btn-white:active {
        background-color: #e9eafb; /* Your previous hover color for white button */
        border-color: #9ca3af;
        transform: scale(0.98);
    }
    .sb-input {
        background-color: #ffffffdd;
        color: var(--text-color);
        border: 2px solid #000000aa;
        border-radius: var(--sb-border-radius-md, 0.375rem);
        padding: 0.5rem;
        font-size: 1rem;
        font-weight: var(--sb-font-semibold);
        font-family: var(--sb-font-sans);
    }
    .htmx-indicator {
        display: none;
    }
</style>
<script type="module" src="{% static 'questions/mjs/quizInterface.mjs' %}"></script>
<link rel="stylesheet" href="{% static 'questions/quiz.css' %}">
<link rel="stylesheet" href="{% static 'questions/css/quiz-interface.css' %}">


{% endblock content %}
